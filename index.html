<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Bridges Park</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#666666;
      --card:#ffffff;
      --border:#dddddd;
      --thead:#f5f5f5;
      --tableLine:#dddddd;
      --btnBg:#efefef;
      --btnText:#111111;

      --scoreUnder:#d1fae5;
      --scoreEven:#f3f4f6;
      --scoreOver:#fee2e2;
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0d10;
        --text:#e8e8e8;
        --muted:#a7a7a7;
        --card:#11151b;
        --border:#2a2f38;
        --thead:#171c24;
        --tableLine:#2a2f38;
        --btnBg:#1b2230;
        --btnText:#e8e8e8;

        --scoreUnder:#0f3b2b;
        --scoreEven:#202634;
        --scoreOver:#3b1416;
      }
    }

    html[data-theme="light"]{
      --bg:#ffffff; --text:#111111; --muted:#666666; --card:#ffffff;
      --border:#dddddd; --thead:#f5f5f5; --tableLine:#dddddd;
      --btnBg:#efefef; --btnText:#111111;
      --scoreUnder:#d1fae5; --scoreEven:#f3f4f6; --scoreOver:#fee2e2;
    }
    html[data-theme="dark"]{
      --bg:#0b0d10; --text:#e8e8e8; --muted:#a7a7a7; --card:#11151b;
      --border:#2a2f38; --thead:#171c24; --tableLine:#2a2f38;
      --btnBg:#1b2230; --btnText:#e8e8e8;
      --scoreUnder:#0f3b2b; --scoreEven:#202634; --scoreOver:#3b1416;
    }

    body{
      font-family:-apple-system,system-ui,sans-serif;
      margin:16px;
      line-height:1.35;
      background:var(--bg);
      color:var(--text);
    }
    .muted{color:var(--muted);font-size:13px}
    .topWrap{max-width:900px}
    .card{
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      margin-top:12px;
      max-width:900px;
      background:var(--card);
    }

    button{
      font-size:16px;
      padding:12px 14px;
      width:100%;
      background:var(--btnBg);
      color:var(--btnText);
      border:1px solid var(--border);
      border-radius:12px;
    }
    input[type=text]{
      font-size:16px;
      padding:8px;
      width:100%;
      box-sizing:border-box;
      background:transparent;
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
    }
    select{
      font-size:16px;
      padding:6px 8px;
      background:transparent;
      color:var(--text);
      border:1px solid var(--border);
      border-radius:10px;
    }

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border-bottom:1px solid var(--tableLine);padding:6px;text-align:center;vertical-align:middle}
    th{background:var(--thead)}
    .left{text-align:left}
    .right{text-align:right}

    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .grow{flex:1 1 180px}
    .header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;max-width:900px}
    .brand{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .brand h1{margin:0;font-size:28px}
    .subtitle{margin:2px 0 0 0}

    .logoImg{
      width:64px;height:64px;border-radius:14px;object-fit:contain;
      border:none !important; outline:none !important; box-shadow:none !important;
      background:transparent;
      display:block;
    }

    .infoGrid{
      display:grid;
      grid-template-columns:repeat(2,minmax(140px,1fr));
      gap:8px;
      margin-top:10px;
    }
    .infoCard{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      background:var(--card);
      text-align:left;
    }
    .infoLabel{font-size:12px;color:var(--muted);margin:0}
    .infoValue{font-size:16px;font-weight:700;margin:2px 0 0 0}

    .themeRow{
      max-width:900px;
      margin-top:10px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .themeRow label{font-size:13px;color:var(--muted)}
    .themeRow select{width:auto;min-width:160px}

    .goal{font-weight:700;text-transform:capitalize}
    .goal-white{background:#ffffff;color:#111;border:1px solid #ddd}
    .goal-orange{background:#ff8a00;color:#111}
    .goal-blue{background:#1f6feb;color:#fff}
    .goal-pink{background:#ff5aa5;color:#111}
    .goal-red{background:#e11d48;color:#fff}
    .goal-green{background:#16a34a;color:#fff}
    .goal-yellow{background:#ffd400;color:#111}
    .goal-tee{background:#111;color:#fff;border:1px solid #111}
    .goalTag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}

    .score-under{background:var(--scoreUnder)}
    .score-even{background:var(--scoreEven)}
    .score-over{background:var(--scoreOver)}

    .pill{border-radius:999px;padding:2px 8px;font-size:12px;display:inline-block}
    .pill-under{background:var(--scoreUnder)}
    .pill-even{background:var(--scoreEven)}
    .pill-over{background:var(--scoreOver)}

    /* Summary display: BIG diff, small throws */
    .sumCell{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:2px;
      line-height:1.1;
    }
    .sumDiff{
      font-size:18px;
      font-weight:800;
      padding:2px 10px;
      border-radius:999px;
      display:inline-block;
      min-width:44px;
    }
    .sumThrows{
      font-size:12px;
      color:var(--muted);
    }

    /* Legend pips - force identical size */
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .swatch{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)}
    .dot{
      width:14px;height:14px;          /* same size */
      box-sizing:border-box;           /* border doesn't change size */
      border-radius:4px;
      border:1px solid var(--border);
      display:inline-block;
      flex:0 0 14px;
    }
    .dot-under{background:var(--scoreUnder)}
    .dot-even{background:var(--scoreEven)}
    .dot-over{background:var(--scoreOver)}

    @media print{
      button,.themeRow{display:none}
      select{border:none;-webkit-appearance:none;appearance:none;background:transparent}
      input[type=text]{border:none}
      body{margin:10px}
    }
  </style>
</head>

<body>

<div class="topWrap">
  <div class="header">
    <div class="brand">
      <img id="logoLight" class="logoImg"
           src="C542D141-EA75-4C1C-9345-50C8E08D9EE5.png"
           alt="Bridges Park logo">
      <img id="logoDark" class="logoImg"
           src="B19327BB-FD35-4A0C-8F34-56CC91793687.png"
           alt="Bridges Park logo (dark)"
           style="display:none;">
      <div>
        <h1>Bridges Park</h1>
        <div class="muted subtitle">Disc Golf • Course Generator + Scorecard</div>
      </div>
    </div>
  </div>

  <div class="themeRow">
    <label for="themeSelect">Theme</label>
    <select id="themeSelect">
      <option value="auto">Auto (System)</option>
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </div>

  <div class="infoGrid" aria-label="Course summary">
    <div class="infoCard">
      <p class="infoLabel">Holes</p>
      <p class="infoValue">18</p>
    </div>
    <div class="infoCard">
      <p class="infoLabel">Par (Front / Back / Total)</p>
      <p class="infoValue"><span id="parFrontTop">–</span> / <span id="parBackTop">–</span> / <span id="parTotalTop">–</span></p>
    </div>
  </div>

  <div class="legend" aria-label="Score color legend">
    <div class="swatch"><span class="dot dot-under"></span> Under par</div>
    <div class="swatch"><span class="dot dot-even"></span> Even par</div>
    <div class="swatch"><span class="dot dot-over"></span> Over par</div>
  </div>

  <div style="margin-top:10px;">
    <button id="btnGen">Generate New Course</button>
  </div>
</div>

<div class="card">
  <h2 style="margin:0 0 6px 0;">Course + Scorecard</h2>

  <div class="row" style="margin-top:8px;">
    <div class="grow">
      <div class="muted" style="margin-bottom:4px;">Player 1</div>
      <input id="n1" type="text" placeholder="Player 1 name">
    </div>
    <div class="grow">
      <div class="muted" style="margin-bottom:4px;">Player 2</div>
      <input id="n2" type="text" placeholder="Player 2 name">
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Hole</th>
        <th>From</th>
        <th>To</th>
        <th>Par</th>
        <th id="p1Head">P1</th>
        <th id="p2Head">P2</th>
      </tr>
    </thead>

    <tbody id="mainBody"></tbody>

    <tfoot>
      <tr>
        <th colspan="4" class="left">Back 9</th>
        <th>
          <div class="sumCell">
            <span id="bd1" class="sumDiff pill pill-even">E</span>
            <span id="b1" class="sumThrows">0</span>
          </div>
        </th>
        <th>
          <div class="sumCell">
            <span id="bd2" class="sumDiff pill pill-even">E</span>
            <span id="b2" class="sumThrows">0</span>
          </div>
        </th>
      </tr>
      <tr>
        <th colspan="4" class="left">Total</th>
        <th>
          <div class="sumCell">
            <span id="d1" class="sumDiff pill pill-even">E</span>
            <span id="t1" class="sumThrows">0</span>
          </div>
        </th>
        <th>
          <div class="sumCell">
            <span id="d2" class="sumDiff pill pill-even">E</span>
            <span id="t2" class="sumDiff pill pill-even" style="display:none;"></span>
            <span id="t2" class="sumThrows">0</span>
          </div>
        </th>
      </tr>
    </tfoot>
  </table>
</div>

<script>
(function(){
  window.addEventListener("error", function(ev){
    alert("Page error: " + (ev && ev.message ? ev.message : "Unknown error"));
  });

  /* Theme + logo swap */
  var themeSelect = document.getElementById("themeSelect");

  function syncLogo(theme){
    var light = document.getElementById("logoLight");
    var dark  = document.getElementById("logoDark");
    if(!light || !dark) return;

    var systemDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;

    var isDark =
      theme === "dark" ||
      (theme === "auto" && systemDark);

    light.style.display = isDark ? "none" : "block";
    dark.style.display  = isDark ? "block" : "none";
  }

  function applyTheme(val){
    if(val==="auto"){
      document.documentElement.removeAttribute("data-theme");
    } else {
      document.documentElement.setAttribute("data-theme", val);
    }
    localStorage.setItem("bp_theme", val);
    syncLogo(val);
  }

  var savedTheme = localStorage.getItem("bp_theme") || "auto";
  themeSelect.value = savedTheme;
  applyTheme(savedTheme);

  themeSelect.addEventListener("change", function(){
    applyTheme(themeSelect.value);
  });

  if (window.matchMedia) {
    try {
      window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", function(){
        var t = localStorage.getItem("bp_theme") || "auto";
        if (t === "auto") syncLogo("auto");
      });
    } catch(e){}
  }

  /* Course generator */
  var GOALS = ["white","orange","blue","pink","red","green","yellow"];
  var HOLES = 18;
  var MINREQ = 2;
  var FIXED = { 9: "green", 18: "green" };

  var DIS = {
    "white":  [],
    "orange": ["pink","blue"],
    "blue":   ["orange","red"],
    "pink":   ["orange","red","green"],
    "red":    ["blue","pink"],
    "green":  ["yellow","pink"],
    "yellow": ["green"]
  };

  var HOLE1_PAR3_TO = { "yellow": true, "pink": true, "white": true };

  function pairKey(a,b){ return (a < b) ? (a+"|"+b) : (b+"|"+a); }
  var PAR3 = {};
  var PAR5 = {};

  [
    ["white","yellow"],
    ["white","green"],
    ["yellow","red"],
    ["yellow","pink"],
    ["green","red"],
    ["red","orange"],
    ["red","blue"],
    ["blue","pink"]
  ].forEach(function(p){ PAR3[pairKey(p[0],p[1])] = true; });

  [
    ["white","blue"],
    ["white","orange"]
  ].forEach(function(p){ PAR5[pairKey(p[0],p[1])] = true; });

  function allowed(prev, next){
    if (!prev) return true;
    if (prev === next) return false;
    var bad = DIS[prev] || [];
    for (var i=0;i<bad.length;i++) if (bad[i]===next) return false;
    return true;
  }

  function edgeKey(from,to){ return from + "->" + to; }

  function shuffle(arr){
    for (var i=arr.length-1;i>0;i--){
      var j = Math.floor(Math.random()*(i+1));
      var t = arr[i]; arr[i]=arr[j]; arr[j]=t;
    }
    return arr;
  }

  function initCounts(){
    var c = {};
    for (var i=0;i<GOALS.length;i++) c[GOALS[i]] = 0;
    return c;
  }

  function futureFixedCount(goal, fromPos){
    var f=0;
    for (var h=fromPos; h<=HOLES; h++){
      if (FIXED[h] === goal) f++;
    }
    return f;
  }

  function remainingUnfixedSlots(fromPos, course){
    var s=0;
    for (var h=fromPos; h<=HOLES; h++){
      if (!FIXED[h] && course[h] === null) s++;
    }
    return s;
  }

  function minNeeded(fromPos, course, used){
    var need=0;
    for (var i=0;i<GOALS.length;i++){
      var g = GOALS[i];
      var future = futureFixedCount(g, fromPos);
      var missing = MINREQ - (used[g] + future);
      if (missing > 0) need += missing;
    }
    return need;
  }

  function feasible(fromPos, course, used){
    return minNeeded(fromPos, course, used) <= remainingUnfixedSlots(fromPos, course);
  }

  function candidateScore(goal, used, fromPos){
    var future = futureFixedCount(goal, fromPos);
    var willHave = used[goal] + future;
    if (willHave < MINREQ) return -100 + used[goal];
    return used[goal];
  }

  function parFor(from,to,hole){
    if (hole === 1){
      return HOLE1_PAR3_TO[to] ? 3 : 4;
    }
    var k = pairKey(from,to);
    if (PAR5[k]) return 5;
    if (PAR3[k]) return 3;
    return 4;
  }

  function formatDiff(d){
    if (d===0) return "E";
    if (d>0) return "+"+d;
    return ""+d;
  }

  function goalClass(goal){
    return "goalTag goal goal-" + goal;
  }

  function generateCourse(){
    var course = [];
    for (var i=0;i<=HOLES;i++) course[i]=null;

    for (var h in FIXED) if (FIXED.hasOwnProperty(h)) course[parseInt(h,10)] = FIXED[h];

    var used = initCounts();
    var usedEdges = {};

    function bt(pos){
      if (pos > HOLES){
        for (var i=0;i<GOALS.length;i++){
          if (used[GOALS[i]] < MINREQ) return false;
        }
        return true;
      }

      var prevGoal = (pos===1) ? "tee" : course[pos-1];

      if (course[pos] !== null){
        var v = course[pos];
        if (pos === 1 && v === "green") return false;
        if (pos > 1 && !allowed(course[pos-1], v)) return false;

        var ek = edgeKey(prevGoal, v);
        if (usedEdges[ek]) return false;

        usedEdges[ek] = true;
        used[v] += 1;

        if (!feasible(pos+1, course, used)) { used[v]-=1; delete usedEdges[ek]; return false; }
        if (bt(pos+1)) return true;

        used[v] -= 1;
        delete usedEdges[ek];
        return false;
      }

      var prev2 = (pos>1) ? course[pos-1] : null;
      var cands = [];

      for (var i2=0;i2<GOALS.length;i2++){
        var g2 = GOALS[i2];

        if (pos === 1 && g2 === "green") continue;
        if (pos > 1 && !allowed(prev2, g2)) continue;

        if (course[pos+1] !== null && !allowed(g2, course[pos+1])) continue;
        if (usedEdges[edgeKey(prevGoal, g2)]) continue;

        cands.push(g2);
      }

      shuffle(cands);
      cands.sort(function(a,b){
        return candidateScore(a, used, pos+1) - candidateScore(b, used, pos+1);
      });

      for (var ci=0; ci<cands.length; ci++){
        var pick = cands[ci];
        var ek2 = edgeKey(prevGoal, pick);

        course[pos] = pick;
        used[pick] += 1;
        usedEdges[ek2] = true;

        if (feasible(pos+1, course, used) && bt(pos+1)) return true;

        delete usedEdges[ek2];
        used[pick] -= 1;
        course[pos] = null;
      }

      return false;
    }

    for (var attempt=1; attempt<=20000; attempt++){
      for (var p=1; p<=HOLES; p++) if (!FIXED[p]) course[p] = null;
      used = initCounts();
      usedEdges = {};

      if (bt(1)){
        var seq = [];
        for (var k=1;k<=HOLES;k++) seq.push(course[k]);
        return { seq: seq };
      }
    }

    return null;
  }

  /* Render + scoring */
  var mainBody = document.getElementById("mainBody");
  var btnGen = document.getElementById("btnGen");
  var n1 = document.getElementById("n1");
  var n2 = document.getElementById("n2");
  var p1Head = document.getElementById("p1Head");
  var p2Head = document.getElementById("p2Head");

  function playerName(idx){
    if (idx===1) return (n1.value || "Player 1").trim();
    return (n2.value || "Player 2").trim();
  }
  function syncPlayerHeaders(){
    p1Head.textContent = playerName(1);
    p2Head.textContent = playerName(2);
  }
  n1.addEventListener("input", syncPlayerHeaders);
  n2.addEventListener("input", syncPlayerHeaders);

  function setDiffPill(el, diffText){
    el.classList.remove("pill-under","pill-even","pill-over");
    if (diffText === "E") el.classList.add("pill-even");
    else if (diffText[0] === "+") el.classList.add("pill-over");
    else el.classList.add("pill-under");
  }

  function makeSelect(hole, player, parVal){
    var sel = document.createElement("select");
    sel.setAttribute("data-hole", ""+hole);
    sel.setAttribute("data-player", ""+player);
    sel.setAttribute("data-par", ""+parVal);

    var opt0 = document.createElement("option");
    opt0.value = "";
    opt0.textContent = "–";
    sel.appendChild(opt0);

    for (var i=1;i<=10;i++){
      var opt = document.createElement("option");
      opt.value = ""+i;
      opt.textContent = ""+i;
      sel.appendChild(opt);
    }

    sel.addEventListener("change", function(){
      colorSelect(sel);
      recalcTotals();
    });
    return sel;
  }

  function colorSelect(sel){
    sel.classList.remove("score-under","score-even","score-over");
    var v = sel.value;
    if (v === "") return;
    var n = parseInt(v,10);
    var p = parseInt(sel.getAttribute("data-par"),10);
    if (isNaN(n) || isNaN(p)) return;
    if (n < p) sel.classList.add("score-under");
    else if (n > p) sel.classList.add("score-over");
    else sel.classList.add("score-even");
  }

  function tdText(txt){
    var td = document.createElement("td");
    td.textContent = txt;
    return td;
  }

  function tdGoal(goal){
    var td = document.createElement("td");
    var span = document.createElement("span");
    span.className = goalClass(goal);
    span.textContent = goal;
    td.appendChild(span);
    return td;
  }

  function tdFrom(from){
    return tdGoal(from === "tee" ? "tee" : from);
  }

  function setTopParSummary(front, back, total){
    document.getElementById("parFrontTop").textContent = front;
    document.getElementById("parBackTop").textContent  = back;
    document.getElementById("parTotalTop").textContent = total;
  }

  function buildFront9Row(){
    var tr = document.createElement("tr");
    tr.setAttribute("id", "front9Row");
    tr.innerHTML = `
      <th colspan="4" class="left">Front 9</th>
      <th>
        <div class="sumCell">
          <span id="fd1" class="sumDiff pill pill-even">E</span>
          <span id="f1" class="sumThrows">0</span>
        </div>
      </th>
      <th>
        <div class="sumCell">
          <span id="fd2" class="sumDiff pill pill-even">E</span>
          <span id="f2" class="sumThrows">0</span>
        </div>
      </th>
    `;
    return tr;
  }

  function renderAll(seq){
    mainBody.innerHTML = "";

    var parFront = 0, parBack = 0, parTotal = 0;

    for (var i=0;i<seq.length;i++){
      var hole = i+1;
      var to = seq[i];
      var from = (i===0) ? "tee" : seq[i-1];
      var p = parFor(from,to,hole);

      parTotal += p;
      if (hole<=9) parFront += p; else parBack += p;

      var tr = document.createElement("tr");
      tr.appendChild(tdText(""+hole));
      tr.appendChild(tdFrom(from));
      tr.appendChild(tdGoal(to));
      tr.appendChild(tdText(""+p));

      var td1 = document.createElement("td");
      td1.appendChild(makeSelect(hole, 1, p));
      tr.appendChild(td1);

      var td2 = document.createElement("td");
      td2.appendChild(makeSelect(hole, 2, p));
      tr.appendChild(td2);

      mainBody.appendChild(tr);

      if (hole === 9){
        mainBody.appendChild(buildFront9Row());
      }
    }

    setTopParSummary(parFront, parBack, parTotal);

    window.__parFront = parFront;
    window.__parBack = parBack;
    window.__parTotal = parTotal;

    recalcTotals();
  }

  function recalcTotals(){
    // NOTE: diff uses "assume par for blanks", throws uses ONLY entered strokes.
    var parFrontTotal = window.__parFront || 0;
    var parBackTotal  = window.__parBack  || 0;
    var parTotalTotal = window.__parTotal || 0;

    for (var pl=1; pl<=2; pl++){
      var fThrows=0,bThrows=0,tThrows=0;
      var fParEntered=0,bParEntered=0,tParEntered=0;

      for (var hole=1; hole<=HOLES; hole++){
        var sel = mainBody.querySelector('select[data-hole="'+hole+'"][data-player="'+pl+'"]');
        if (!sel) continue;

        var par = parseInt(sel.getAttribute("data-par"),10) || 0;
        var v = sel.value;

        if (v !== ""){
          var n = parseInt(v,10);
          if (!isNaN(n)){
            tThrows += n;
            tParEntered += par;

            if (hole<=9){
              fThrows += n;
              fParEntered += par;
            } else {
              bThrows += n;
              bParEntered += par;
            }
          }
        }
      }

      // Small numbers = entered throws
      var fEl = document.getElementById("f"+pl);
      var bEl = document.getElementById("b"+pl);
      var tEl = document.getElementById("t"+pl);
      if (fEl) fEl.textContent = ""+fThrows;
      if (bEl) bEl.textContent = ""+bThrows;
      if (tEl) tEl.textContent = ""+tThrows;

      // Big numbers = (entered throws - entered par). Blanks contribute 0 to diff.
      var fd = document.getElementById("fd"+pl);
      var bd = document.getElementById("bd"+pl);
      var d  = document.getElementById("d"+pl);

      if (fd){
        fd.textContent = formatDiff(fThrows - fParEntered);
        setDiffPill(fd, fd.textContent);
      }
      if (bd){
        bd.textContent = formatDiff(bThrows - bParEntered);
        setDiffPill(bd, bd.textContent);
      }
      if (d){
        d.textContent = formatDiff(tThrows - tParEntered);
        setDiffPill(d, d.textContent);
      }
    }
  }

  function clearScores(){
    var sels = mainBody.querySelectorAll("select");
    for (var i=0;i<sels.length;i++){
      sels[i].value = "";
      sels[i].classList.remove("score-under","score-even","score-over");
    }
    recalcTotals();
  }

  function generateAndRender(){
    syncPlayerHeaders();
    var r = generateCourse();
    if (!r){
      alert("Could not generate a valid course. Try again.");
      return;
    }
    renderAll(r.seq);
    clearScores();
  }

  btnGen.addEventListener("click", generateAndRender);

  syncPlayerHeaders();
  generateAndRender();
})();
</script>

</body>
</html>
