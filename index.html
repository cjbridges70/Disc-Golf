<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Disc Golf Course Randomizer</title>
<style>
body{font-family:-apple-system,system-ui,sans-serif;margin:16px}
button{font-size:16px;padding:10px 14px;margin:6px 6px 0 0}
input[type=text]{font-size:16px;padding:8px;width:100%}
select{font-size:16px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border-bottom:1px solid #ddd;padding:6px;text-align:center}
th{background:#f5f5f5}
.right{text-align:right}
.card{border:1px solid #ddd;border-radius:12px;padding:12px;margin-top:12px}
.pill{background:#eee;border-radius:999px;padding:2px 8px;font-size:12px}
@media print{.no-print{display:none}}
</style>
</head>
<body>

<div class="no-print">
<h1>Disc Golf Course Randomizer</h1>
<button onclick="generate()">Generate Course</button>
<button onclick="copyAll()">Copy Course + Scores</button>
<button onclick="window.print()">Print / PDF</button>
<div id="status"></div>
</div>

<div class="card">
<h2>Course</h2>
<table>
<thead>
<tr><th>Hole</th><th>From</th><th>To</th><th>Par</th></tr>
</thead>
<tbody id="course"></tbody>
<tfoot>
<tr><th colspan="3">Front 9 Par</th><th id="fp"></th></tr>
<tr><th colspan="3">Back 9 Par</th><th id="bp"></th></tr>
<tr><th colspan="3">Total Par</th><th id="tp"></th></tr>
</tfoot>
</table>
</div>

<div class="card">
<h2>Scorecard</h2>
<table>
<thead>
<tr>
<th>Hole</th><th>Par</th>
<th><input id="n1" placeholder="Player 1"></th>
<th><input id="n2" placeholder="Player 2"></th>
<th><input id="n3" placeholder="Player 3"></th>
<th><input id="n4" placeholder="Player 4"></th>
</tr>
</thead>
<tbody id="scores"></tbody>
<tfoot>
<tr><th colspan="2">Front</th>
<th><span id="f1"></span> <span id="fd1" class="pill"></span></th>
<th><span id="f2"></span> <span id="fd2" class="pill"></span></th>
<th><span id="f3"></span> <span id="fd3" class="pill"></span></th>
<th><span id="f4"></span> <span id="fd4" class="pill"></span></th>
</tr>
<tr><th colspan="2">Back</th>
<th><span id="b1"></span> <span id="bd1" class="pill"></span></th>
<th><span id="b2"></span> <span id="bd2" class="pill"></span></th>
<th><span id="b3"></span> <span id="bd3" class="pill"></span></th>
<th><span id="b4"></span> <span id="bd4" class="pill"></span></th>
</tr>
<tr><th colspan="2">Total</th>
<th><span id="t1"></span> <span id="d1" class="pill"></span></th>
<th><span id="t2"></span> <span id="d2" class="pill"></span></th>
<th><span id="t3"></span> <span id="d3" class="pill"></span></th>
<th><span id="t4"></span> <span id="d4" class="pill"></span></th>
</tr>
</tfoot>
</table>
</div>

<script>
const GOALS=["white","orange","blue","pink","red","green","yellow"];
const DIS={
 white:[],
 orange:["pink","blue"],
 blue:["orange","red"],
 pink:["orange","red","green"],
 red:["blue","pink"],
 green:["yellow","pink"],
 yellow:["green"]
};
const FIXED={9:"green",18:"green"};
const PAR3_HOLE1={white:1,yellow:1,pink:1};
const PAR3=[["white","yellow"],["white","green"],["yellow","red"],["yellow","pink"],["green","red"],["red","orange"],["red","blue"]];
const PAR5=[["white","blue"],["white","orange"]];

function pair(a,b){return a<b?a+"|"+b:b+"|"+a}
const P3=new Set(PAR3.map(p=>pair(p[0],p[1])));
const P5=new Set(PAR5.map(p=>pair(p[0],p[1])));

function allowed(a,b){return a!==b && !(DIS[a]||[]).includes(b)}
function par(from,to,h){if(h===1)return PAR3_HOLE1[to]?3:4;let k=pair(from,to);return P5.has(k)?5:P3.has(k)?3:4}

function generate(){
 let used={},edges={},course=Array(19).fill(null);
 GOALS.forEach(g=>used[g]=0);
 Object.entries(FIXED).forEach(([h,g])=>course[h]=g);

 function bt(i){
  if(i>18) return GOALS.every(g=>used[g]>=2);
  let from=i===1?"tee":course[i-1];
  if(course[i]){
   let g=course[i],k=from+"->"+g;
   if(i===1&&g==="green")return false;
   if(i>1&&!allowed(course[i-1],g))return false;
   if(edges[k])return false;
   edges[k]=1;used[g]++;
   if(bt(i+1))return true;
   delete edges[k];used[g]--;return false;
  }
  for(let g of GOALS.sort(()=>Math.random()-.5)){
   if(i===1&&g==="green")continue;
   if(i>1&&!allowed(course[i-1],g))continue;
   let k=from+"->"+g;
   if(edges[k])continue;
   if(course[i+1]&&!allowed(g,course[i+1]))continue;
   course[i]=g;used[g]++;edges[k]=1;
   if(bt(i+1))return true;
   delete edges[k];used[g]--;course[i]=null;
  }
  return false;
 }

 for(let t=0;t<15000;t++){
  course=course.map((v,i)=>FIXED[i]||null);
  used={};edges={};GOALS.forEach(g=>used[g]=0);
  if(bt(1)) return course.slice(1);
 }
 alert("Could not generate â€” try again");
}

function generate(){
 const seq=(()=>{let r;while(!(r=gen())){}return r})();
 render(seq)
}

function gen(){return generate.__g||(generate.__g=generate)}

function render(seq){
 const c=document.getElementById("course"),s=document.getElementById("scores");
 c.innerHTML="";s.innerHTML="";
 let fp=0,bp=0,tp=0;
 seq.forEach((g,i)=>{
  let h=i+1,f=i?seq[i-1]:"tee",p=par(f,g,h);
  if(h<=9)fp+=p;else bp+=p;tp+=p;
  c.innerHTML+=`<tr><td>${h}</td><td>${f}</td><td>${g}</td><td>${p}</td></tr>`;
  let row=`<tr><td>${h}</td><td>${p}</td>`;
  for(let j=1;j<=4;j++){
   row+=`<td><select data-h="${h}" data-p="${j}" onchange="calc()"><option></option>${[...Array(10)].map((_,i)=>`<option>${i+1}</option>`).join("")}</select></td>`;
  }
  row+="</tr>";s.innerHTML+=row;
 });
 document.getElementById("fp").textContent=fp;
 document.getElementById("bp").textContent=bp;
 document.getElementById("tp").textContent=tp;
 calc()
}

function calc(){
 let fp=+document.getElementById("fp").textContent;
 let bp=+document.getElementById("bp").textContent;
 let tp=+document.getElementById("tp").textContent;
 for(let p=1;p<=4;p++){
  let f=0,b=0,t=0;
  document.querySelectorAll(`select[data-p="${p}"]`).forEach(s=>{
   let v=+s.value||0,h=+s.dataset.h;
   if(h<=9)f+=v;else b+=v;t+=v;
  });
  document.getElementById("f"+p).textContent=f;
  document.getElementById("b"+p).textContent=b;
  document.getElementById("t"+p).textContent=t;
  document.getElementById("fd"+p).textContent=diff(f-fp);
  document.getElementById("bd"+p).textContent=diff(b-bp);
  document.getElementById("d"+p).textContent=diff(t-tp);
 }
}
function diff(d){return d===0?"E":d>0?`+${d}`:d}
function copyAll(){
 let txt=[...document.querySelectorAll("table")].map(t=>t.innerText).join("\n\n");
 navigator.clipboard.writeText(txt);
}
generate();
</script>

</body>
</html>
