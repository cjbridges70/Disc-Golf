<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Disc Golf Course Randomizer + Par</title>
  <style>
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, sans-serif; margin: 16px; line-height: 1.35; }
    button { font-size: 16px; padding: 10px 14px; margin: 6px 6px 0 0; }
    .muted { color: #666; font-size: 13px; }
    .ok { color: #0a7; font-weight: 700; }
    .bad { color: #c33; font-weight: 800; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border-bottom: 1px solid #ddd; padding: 7px 6px; text-align: left; }
    th { background: #f5f5f5; }
    .right { text-align: right; }
    @media print { .no-print { display:none; } body { margin: 10mm; } }
  </style>
</head>
<body>

<div class="no-print">
  <h1>Disc Golf Course Randomizer + Par</h1>
  <div class="muted">
    Enforces all rules including <b>unique throws</b> (same from→to never repeats).
  </div>

  <button id="gen">Generate Course</button>
  <button id="copy">Copy Course</button>
  <button onclick="window.print()">Print / Save PDF</button>

  <div id="status" class="muted" style="margin-top:8px;"></div>
</div>

<table>
  <thead>
    <tr>
      <th>Hole</th>
      <th>From</th>
      <th>To</th>
      <th class="right">Par</th>
    </tr>
  </thead>
  <tbody id="course"></tbody>
  <tfoot>
    <tr>
      <th colspan="3" class="right">Total Par</th>
      <th id="totalPar" class="right"></th>
    </tr>
  </tfoot>
</table>

<script>
(function(){
  var GOALS=["white","orange","blue","pink","red","green","yellow"];
  var FIXED={9:"green",18:"green"};
  var MINREQ=2;

  var DIS={
    white:[],
    orange:["pink","blue"],
    blue:["orange","red"],
    pink:["orange","red"],
    red:["blue","pink"],
    green:["yellow"],
    yellow:["green"]
  };

  var HOLE1_PAR3={yellow:1,pink:1};

  function pair(a,b){return a<b?a+"|"+b:b+"|"+a;}
  var PAR3={},PAR5={};

  [
    ["white","yellow"],["white","green"],["yellow","red"],["yellow","pink"],
    ["green","pink"],["green","red"],["red","orange"],["red","blue"]
  ].forEach(p=>PAR3[pair(p[0],p[1])]=1);

  [["white","blue"],["white","orange"]].forEach(p=>PAR5[pair(p[0],p[1])]=1);

  function allowed(a,b){
    if(!a) return true;
    if(a===b) return false;
    return !(DIS[a]||[]).includes(b);
  }

  function gen(){
    var course=Array(19).fill(null);
    var used={},edges={};
    GOALS.forEach(g=>used[g]=0);
    for(var h in FIXED) course[h]=FIXED[h];

    function bt(i){
      if(i>18) return GOALS.every(g=>used[g]>=MINREQ);
      var from=i===1?"tee":course[i-1];
      if(course[i]){
        var to=course[i];
        if(i===1&&to==="green") return false;
        if(i>1&&!allowed(course[i-1],to)) return false;
        var e=from+"->"+to;
        if(edges[e]) return false;
        edges[e]=1; used[to]++;
        if(bt(i+1)) return true;
        delete edges[e]; used[to]--; return false;
      }
      var cands=GOALS.filter(g=>{
        if(i===1&&g==="green") return false;
        if(i>1&&!allowed(course[i-1],g)) return false;
        if(edges[from+"->"+g]) return false;
        if(course[i+1]&&!allowed(g,course[i+1])) return false;
        return true;
      });
      for(var g of cands.sort(()=>Math.random()-0.5)){
        var e2=from+"->"+g;
        course[i]=g; used[g]++; edges[e2]=1;
        if(bt(i+1)) return true;
        delete edges[e2]; used[g]--; course[i]=null;
      }
      return false;
    }

    for(var t=0;t<8000;t++){
      GOALS.forEach(g=>used[g]=0);
      course=course.map((v,i)=>FIXED[i]||null);
      edges={};
      if(bt(1)) return course.slice(1);
    }
    return null;
  }

  function par(from,to,h){
    if(h===1) return HOLE1_PAR3[to]?3:4;
    var k=pair(from,to);
    if(PAR5[k]) return 5;
    if(PAR3[k]) return 3;
    return 4;
  }

  function render(seq){
    var tb=document.getElementById("course");
    tb.innerHTML="";
    var tot=0;
    seq.forEach((g,i)=>{
      var f=i?seq[i-1]:"tee";
      var p=par(f,g,i+1);
      tot+=p;
      tb.innerHTML+=`<tr><td>${i+1}</td><td>${f}</td><td>${g}${(i+1===9||i+1===18)?" ✅":""}</td><td class="right">${p}</td></tr>`;
    });
    document.getElementById("totalPar").textContent=tot;
    document.getElementById("status").innerHTML="<span class='ok'>Generated</span>";
    window.__last=seq;
  }

  document.getElementById("gen").onclick=function(){
    var s=gen();
    if(!s) document.getElementById("status").innerHTML="<span class='bad'>Could not generate – try again</span>";
    else render(s);
  };

  document.getElementById("copy").onclick=function(){
    if(!window.__last) return;
    var out=[];
    window.__last.forEach((g,i)=>{
      var f=i?window.__last[i-1]:"tee";
      out.push(`Hole ${i+1}: ${f} -> ${g} (Par ${par(f,g,i+1)})`);
    });
    out.push("Total Par: "+document.getElementById("totalPar").textContent);
    navigator.clipboard?navigator.clipboard.writeText(out.join("\\n")):prompt("Copy:",out.join("\\n"));
  };

  document.getElementById("gen").click();
})();
</script>

</body>
</html>
