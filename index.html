<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Disc Golf Course Randomizer</title>
  <style>
    body {
      font-family: -apple-system, system-ui, Segoe UI, Roboto, sans-serif;
      margin: 16px;
    }
    button {
      font-size: 16px;
      padding: 10px 14px;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }
    th { background: #f5f5f5; }
    .ok { color: #0a7; font-weight: bold; }
    .bad { color: #c33; font-weight: bold; }
    .muted { color: #666; font-size: 13px; }

    @media print {
      .no-print { display: none; }
      body { margin: 10mm; }
    }
  </style>
</head>
<body>

<div class="no-print">
  <h1>Disc Golf Course Randomizer</h1>
  <p class="muted">
    Rules enforced: 18 holes • hole 9 & 18 = green • start not green • no repeats • directional rules • each goal ≥ 2
  </p>

  <button id="gen">Generate Course</button>
  <button id="copy">Copy Course</button>
  <button onclick="window.print()">Print / Save PDF</button>
  <div id="status" class="muted"></div>
</div>

<table>
  <thead>
    <tr><th>Hole</th><th>Goal</th></tr>
  </thead>
  <tbody id="course"></tbody>
</table>

<script>
(function () {

  var GOALS = ["white","orange","blue","pink","red","green","yellow"];
  var FIXED = {9:"green",18:"green"};
  var MIN = 2;

  var BLOCK = {
    white:[],
    orange:["pink","blue"],
    blue:["orange","red"],
    pink:["orange","red"],
    red:["blue","pink"],
    green:["yellow"],
    yellow:["green"]
  };

  function bad(prev,next){
    if(!prev) return false;
    if(prev===next) return true;
    return BLOCK[prev].indexOf(next)!==-1;
  }

  function shuffle(a){
    for(var i=a.length-1;i>0;i--){
      var j=Math.floor(Math.random()*(i+1));
      var t=a[i]; a[i]=a[j]; a[j]=t;
    }
    return a;
  }

  function generate(){
    var course = new Array(19).fill(null);
    var used = {};
    GOALS.forEach(g=>used[g]=0);
    for(var h in FIXED) course[h]=FIXED[h];

    function futureNeed(pos){
      var need=0;
      GOALS.forEach(function(g){
        var future=0;
        for(var k=pos;k<=18;k++) if(FIXED[k]===g) future++;
        var missing=MIN-(used[g]+future);
        if(missing>0) need+=missing;
      });
      var slots=0;
      for(var k2=pos;k2<=18;k2++) if(!course[k2]) slots++;
      return need<=slots;
    }

    function bt(pos){
      if(pos>18){
        return GOALS.every(g=>used[g]>=MIN);
      }

      if(course[pos]){
        if(pos===1 && course[pos]==="green") return false;
        if(bad(course[pos-1],course[pos])) return false;
        used[course[pos]]++;
        if(!futureNeed(pos+1)){ used[course[pos]]--; return false; }
        if(bt(pos+1)) return true;
        used[course[pos]]--;
        return false;
      }

      var cand=[];
      GOALS.forEach(function(g){
        if(pos===1 && g==="green") return;
        if(!bad(course[pos-1],g)) cand.push(g);
      });
      shuffle(cand);

      for(var i=0;i<cand.length;i++){
        var g=cand[i];
        if(course[pos+1] && bad(g,course[pos+1])) continue;
        course[pos]=g; used[g]++;
        if(futureNeed(pos+1) && bt(pos+1)) return true;
        used[g]--; course[pos]=null;
      }
      return false;
    }

    for(var tries=0;tries<200;tries++){
      for(var i2=1;i2<=18;i2++) if(!FIXED[i2]) course[i2]=null;
      GOALS.forEach(g=>used[g]=0);
      if(bt(1)) return course.slice(1);
    }
    return null;
  }

  function render(seq){
    var tbody=document.getElementById("course");
    tbody.innerHTML="";
    if(!seq){
      document.getElementById("status").innerHTML='<span class="bad">Could not generate course</span>';
      return;
    }
    document.getElementById("status").innerHTML='<span class="ok">Generated!</span>';
    seq.forEach(function(g,i){
      var tr=document.createElement("tr");
      tr.innerHTML="<td>"+(i+1)+"</td><td>"+g+((i+1===9||i+1===18)?" ✅":"")+"</td>";
      tbody.appendChild(tr);
    });
    window.lastSeq=seq;
  }

  document.getElementById("gen").onclick=function(){
    render(generate());
  };

  document.getElementById("copy").onclick=function(){
    if(!window.lastSeq) return;
    var t=[];
    window.lastSeq.forEach((g,i)=>t.push("Hole "+(i+1)+": "+g));
    var txt=t.join("\\n");
    if(navigator.clipboard) navigator.clipboard.writeText(txt);
    else window.prompt("Copy:",txt);
  };

  render(generate());

})();
</script>

</body>
</html>
